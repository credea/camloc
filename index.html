<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera Capture</title>
  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>
</head>

<body>

  <h3>Kamera</h3>

  <video id="video" autoplay playsinline muted style="width:100%;max-width:360px;background:#000;"></video>
  <br><br>

  <button id="captureBtn">Capture</button>
  <br><br>

  <canvas id="canvas" style="display:none;"></canvas>
  <br><br>

  <button id="sendBtn" style="display:none;">Kirim ke Bot</button>

  <script>
    Telegram.WebApp.showAlert("WebApp ACTIVE?\n\ninitData: " + (Telegram.WebApp.initData || "EMPTY"))
    
    Telegram.WebApp.expand();

    const video = document.getElementById("video");
    const canvas = document.getElementById("canvas");
    const captureBtn = document.getElementById("captureBtn");
    const sendBtn = document.getElementById("sendBtn");

    // ðŸ”¹ Nyalakan kamera belakang
    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: { ideal: "environment" } }
        });

        video.srcObject = stream;
        await video.play();
      } catch (err) {
        alert("Gagal akses kamera: " + err.message);
      }
    }

    startCamera();

    // ðŸ”¹ Capture foto dari video
    captureBtn.onclick = function () {
      const ctx = canvas.getContext("2d");
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;

      ctx.drawImage(video, 0, 0);

      canvas.style.display = "block";
      sendBtn.style.display = "inline-block";
    };

    // ðŸ”¹ Kirim ke Bot via WebApp Data
    sendBtn.onclick = function () {
        console.log("CLICKED SEND BUTTON");
  Telegram.WebApp.showAlert("Send button clicked");
      const base64 = canvas.toDataURL("image/jpeg");

      Telegram.WebApp.sendData(JSON.stringify({
        type: "photo",
        image: base64
      }));

      Telegram.WebApp.close();
    };
  </script>

</body>
</html>
