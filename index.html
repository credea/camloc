<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>WebApp Test</title>
  <style>
    body {
      text-align: center;
      font-family: sans-serif;
      padding: 2rem;
      background: var(--tg-theme-bg-color, #fff);
      color: var(--tg-theme-text-color, #000);
    }
    .status {
      margin-top: 2rem;
      padding: 1rem;
      border-radius: 8px;
      background: var(--tg-theme-secondary-bg-color, #f0f0f0);
    }
    .info {
      font-size: 0.9rem;
      color: var(--tg-theme-hint-color, #999);
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h3>üîò Test WebApp</h3>
  <p>Klik tombol "Kirim Pesan" di bawah layar üëá</p>
  
  <div class="status" id="status">
    ‚è≥ Menunggu aksi...
  </div>
  
  <div class="info" id="info"></div>

  <script src="https://telegram.org/js/telegram-web-app.js?59"></script>
  <script>
    const tg = window.Telegram.WebApp;
    const statusEl = document.getElementById('status');
    const infoEl = document.getElementById('info');
    
    // Inisialisasi WebApp
    tg.ready();
    tg.expand(); // Buka fullscreen
    
    // Tampilkan info user (opsional, untuk debugging)
    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
      const user = tg.initDataUnsafe.user;
      infoEl.innerHTML = `
        üë§ User: ${user.first_name || 'Unknown'}<br>
        üÜî ID: ${user.id || 'N/A'}
      `;
    }
    
    // ========================================
    // Setup Main Button (tombol bawaan Telegram)
    // ========================================
    tg.MainButton.setText("‚úÖ Kirim Pesan");
    tg.MainButton.color = "#4CAF50"; // Warna hijau
    tg.MainButton.textColor = "#FFFFFF"; // Teks putih
    tg.MainButton.show(); // Tampilkan tombol
    
    // ========================================
    // Event ketika tombol diklik
    // ========================================
    tg.MainButton.onClick(() => {
      console.log("MainButton diklik!");
      
      // Update status
      statusEl.innerHTML = "üì§ Mengirim data...";
      tg.MainButton.showProgress(); // Tampilkan loading
      
      // Simulasi delay (hapus ini jika tidak perlu)
      setTimeout(() => {
        // Data yang akan dikirim ke bot
        const dataToSend = {
          type: "test",
          msg: "Halo dari WebApp üëã",
          timestamp: new Date().toISOString(),
          user_id: tg.initDataUnsafe?.user?.id || null
        };
        
        // Kirim data ke bot (ini yang trigger fungsi webApp di Apps Script)
        tg.sendData(JSON.stringify(dataToSend));
        
        // Update status
        statusEl.innerHTML = "‚úÖ Data terkirim!";
        
        // Tutup WebApp setelah 1 detik (opsional)
        setTimeout(() => {
          tg.close();
        }, 1000);
      }, 500);
    });
    
    // ========================================
    // Handle tombol Back (jika user tap back)
    // ========================================
    tg.BackButton.onClick(() => {
      tg.close();
    });
    
    // Tampilkan tombol Back (opsional)
    // tg.BackButton.show();
    
  </script>
</body>
</html>
